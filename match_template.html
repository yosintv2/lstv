<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{FIXTURE}} Live Streaming & TV Channels | CricFootTV</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .section-header { background: #002d56; color: white; padding: 10px 15px; font-weight: 800; text-transform: uppercase; font-size: 12px; border-left: 4px solid #f90; margin-top: 20px; }
        .channel-pill { display: inline-block; background: #f1f5f9; color: #2563eb; padding: 3px 10px; border-radius: 4px; margin: 2px; text-decoration: none; font-weight: 700; border: 1px solid #e2e8f0; font-size: 12px; }
        .broadcast-row { display: flex; padding: 12px; border-bottom: 1px solid #e2e8f0; background: white; align-items: center; }
        .country-name { flex: 0 0 100px; font-weight: 800; color: #475569; font-size: 13px; }
        .stat-bar-bg { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; width: 100%; position: relative; }
        .stat-bar-fill { background: #2563eb; height: 100%; transition: width 0.5s; }
    </style>
</head>
<body>

    <header class="bg-[#002d56] p-4 border-b-4 border-orange-500 text-center">
        <a href="{{DOMAIN}}/" class="text-white font-black text-2xl">CRICFOOT<span class="text-orange-500">TV</span></a>
    </header>

    <div class="bg-gradient-to-b from-[#002d56] to-[#00447c] text-white py-10 px-4 text-center">
        <div class="inline-block px-3 py-1 bg-orange-500 text-[10px] font-bold rounded mb-2 uppercase">{{LEAGUE}}</div>
        <h1 class="text-3xl md:text-5xl font-black tracking-tighter">{{FIXTURE}}</h1>
        <div class="flex justify-center gap-4 mt-4 text-sm opacity-80">
            <span>ðŸ“… {{LOCAL_DATE}}</span> <span>ðŸ•’ {{LOCAL_TIME}}</span>
        </div>
        <div id="live-odds" class="mt-4 text-orange-400 font-bold text-xs uppercase"></div>
    </div>

    <main class="max-w-4xl mx-auto p-4">
        <div class="grid md:grid-cols-2 gap-4">
            <div id="h2h-box"></div>
            <div id="form-box"></div>
        </div>

        <div class="section-header">Official TV Channels</div>
        <div class="bg-white shadow rounded-b-lg">{{BROADCAST_ROWS}}</div>

        <div class="section-header">Live Match Statistics</div>
        <div id="sofa-stats" class="bg-white p-6 shadow rounded-b-lg">
            <p class="text-gray-400 text-center text-sm">Stats will update live at kickoff...</p>
        </div>

        <div class="section-header">Confirmed Lineups</div>
        <div id="sofa-lineups" class="bg-white p-6 shadow rounded-b-lg mb-10">
            <p class="text-gray-400 text-center text-sm">Lineups usually announced 60m before kickoff.</p>
        </div>
    </main>

    <script>
        const matchId = "{{MATCH_ID}}";
        
        async function fetchSofa(endpoint) {
            try {
                const res = await fetch(`https://api.sofascore.com/api/v1/event/${matchId}/${endpoint}`);
                return res.json();
            } catch (e) { return null; }
        }

        async function initLivePage() {
            if(!matchId) return;

            // 1. Odds
            const odds = await fetchSofa('provider/1/winning-odds');
            if(odds?.winningOdds) {
                document.getElementById('live-odds').innerText = `Home: ${odds.winningOdds.home} | Draw: ${odds.winningOdds.draw} | Away: ${odds.winningOdds.away}`;
            }

            // 2. Form
            const form = await fetchSofa('pregame-form');
            if(form) {
                let html = '<div class="section-header">Team Form</div><div class="bg-white p-4 shadow flex justify-between items-center">';
                ['home', 'away'].forEach(side => {
                    html += '<div class="flex gap-1">';
                    form[side].forEach(f => {
                        const color = f.label === 'W' ? 'bg-green-500' : (f.label === 'L' ? 'bg-red-500' : 'bg-gray-400');
                        html += `<span class="${color} text-white w-6 h-6 flex items-center justify-center rounded text-[10px] font-bold">${f.label}</span>`;
                    });
                    html += '</div>';
                    if(side === 'home') html += '<span class="font-bold">VS</span>';
                });
                document.getElementById('form-box').innerHTML = html + '</div>';
            }

            // 3. Lineups
            const lineups = await fetchSofa('lineups');
            if(lineups?.confirmed) {
                let html = '<div class="grid grid-cols-2 gap-8">';
                ['home', 'away'].forEach(side => {
                    html += `<div><h3 class="font-bold border-b mb-2 text-blue-600 uppercase text-xs">${side} XI</h3><ul class="text-sm">`;
                    lineups[side].players.forEach(p => {
                        html += `<li class="py-1 border-b border-gray-50">${p.player.name} <span class="text-gray-400 text-[10px] float-right">#${p.shirtNumber}</span></li>`;
                    });
                    html += '</ul></div>';
                });
                document.getElementById('sofa-lineups').innerHTML = html + '</div>';
            }

            // 4. Statistics
            const stats = await fetchSofa('statistics');
            if(stats?.statistics) {
                const fullStats = stats.statistics.find(s => s.period === 'ALL')?.groups;
                if(fullStats) {
                    let html = '';
                    fullStats.forEach(group => {
                        group.statisticsItems.forEach(item => {
                            html += `<div class="mb-4">
                                <div class="flex justify-between text-xs font-bold mb-1">
                                    <span>${item.home}</span><span class="text-gray-400 uppercase">${item.name}</span><span>${item.away}</span>
                                </div>
                                <div class="stat-bar-bg flex">
                                    <div class="bg-blue-600 h-full" style="width: ${item.homeValue}%"></div>
                                    <div class="bg-orange-500 h-full" style="width: ${item.awayValue}%"></div>
                                </div>
                            </div>`;
                        });
                    });
                    document.getElementById('sofa-stats').innerHTML = html;
                }
            }
        }

        initLivePage();
    </script>
</body>
</html>
